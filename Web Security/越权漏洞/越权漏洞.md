# 前言

最近在实习，因为是做渗透项目，需要对一些基本漏洞有更深一步的了解，于是就想来打一下portswigger的靶场，为了以后测试回顾，就拿一篇文章记录下来

# 访问控制漏洞

## 不受保护的管理功能

Robots.txt泄露了管理面板地址

![image-20230328124000829](images/1.png)

管理面板未授权访问

![image-20230328124046826](images/2.png)

删除对应用户

## 具有不可预测的 URL 的未受保护的管理功能

![image-20230328124141179](images/3.png)

网页源代码中，判断是否是admin，但是给出了跳转页面是admin管理面板，直接可以未授权访问

![image-20230328124238173](images/4.png)

## 由请求参数控制的用户角色

![image-20230328124330004](images/5.png)

这次给出了一个账号，并且要求我们去删除carlos用户

本次实验有两个url，一个是admin，一个是login

当访问admin的时候

![image-20230328125230714](images/6.png)

会有一个关于是不是admin用户的认证，不过我们有一个测试用户，可以看看能不能越权到admin进行修改

![image-20230328130442063](images/7.png)

登陆进去后，访问admin还是权限不够，但是在cookie中看到了Admin相关的cookie为false，猜测通过这里鉴权，直接修改为true

![image-20230328130548972](images/8.png)

## 可以在用户配置文件中修改用户角色

![image-20230328134339403](images/9.png)

这里说要访问admin的话需要带上roleid为2，在我们登陆后并没有看到什么，不过可以update邮箱

![image-20230328134508677](images/10.png)

抓包

![image-20230328134554132](images/11.png)

发包看到roleid，开始因为是只在前端验证了，修改返回包中的roleid为2，但是未果，后面才知道直接在发包的时候添加roleid参数为2，在返回包中就看到了roleid已经被修改了

![image-20230328135444604](images/12.png)

![image-20230328135553120](images/13.png)

## 请求参数控制的用户ID

![image-20230328135730488](images/14.png)

![image-20230328135949646](images/15.png)

登陆后看到了自己的API Key，访问my account

![image-20230328140235631](images/16.png)

看到了ID参数包含了自己的用户名，尝试将用户名更换为其他用户

![image-20230328140321508](images/17.png)

看到了carlos的api key，这就是水平越权了，甚至还可以根据这一点进行用户名爆破等操作

## 请求参数控制用户ID，用户ID不可预测

![image-20230328140501601](images/18.png)

![image-20230328140543312](images/19.png)

这次是通过一个id来进行访问控制的，但是却进行了编码，这种情况下爆破是不行了，在首页的文章中找到了其他用户发布的文章，其中泄露了其他用户的ID

![image-20230328140948705](images/20.png)

![image-20230328141041027](images/21.png)

![image-20230328141117619](images/22.png)

修改后拿到carlos的api key

## 用户ID受请求参数控制，重定向时数据泄露

抓包查看my account的时候，在重定向的时候通过用户名重定向，修改用户名

![image-20230328141348844](images/23.png)

注意，这里重定向的时候会重定向到主页的登陆页面，但是在repeater发包的时候还是看到泄漏的api key

![image-20230328141752174](images/24.png)

## 由请求参数控制的用户 ID，密码泄露

![image-20230328141834104](images/25.png)

在查看my account的时候，发现原本的密码已经被填充在里面了，抓包查看

![image-20230328142304114](images/26.png)

和上一个一样，通过用户名传参识别，于是修改为管理员的用户名，这里最开始修改admin发现不行，后面看到居然用户名是administrator

![image-20230328142415088](images/27.png)

拿到admin的用户名和密码

![image-20230328142513336](images/28.png)

## 不安全的直接对象引用

![image-20230328142550285](images/29.png)

![image-20230328142741227](images/30.png)

在原来的基础上增加了一个live chat的功能，而且我们可以view transcript下载文件

![image-20230328142836926](images/31.png)

发现是从2开始逐渐递增的

![image-20230328142918652](images/32.png)

并且通过明文进行下载，可以看看1.txt里面有没有东西

![image-20230328143013735](images/33.png)

发现了密码，根据题目的信息，登陆carlos账户

![image-20230328143306097](images/34.png)

## 可以规避基于 URL 的访问控制

![image-20230328144522027](images/35.png)

![image-20230328144617383](images/36.png)

尝试加载/admin并观察是否被阻止（响应非常简单，表明可能来自前端系统）

访问admin抓包，添加头部X-Original-URL:/admin

![image-20230328151057032](images/37.png)

再修改访问路径为/

![image-20230328151203110](images/38.png)

删除用户时任需这样操作，最终修改数据包为

![image-20230328151326692](images/39.png)



剩下的几个感觉平常没有什么用，就没有复现了